<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{/layout/layout}">
<head>
    <meta charset="UTF-8">
    <title>장바구니</title>
</head>
<body>
<div layout:fragment="content">
    <h2 class="tit_main">장바구니</h2>
    <div class="wrap_table bg-white shadow-sm">
        <table class="table table-bordered tbl_cart">
            <thead class="thead-light">
            <tr>
                <th class="text-center" style="width:3%">
                    <div class="form-check">
                        <input type="checkbox" id="chkAll" class="form-check-input">
                        <label for="chkAll" class="form-check-label"></label>
                    </div>
                </th>
                <th class="text-center">상품 정보</th>
                <th class="text-center" style="width:10%">수량</th>
                <th class="text-center" style="width:15%">상품금액</th>
                <th class="text-center" style="width:15%">배송비</th>
                <th class="text-center" style="width:10%">삭제</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="item : ${cartItems}">
                <td>
                    <div class="form-check">
                        <input type="checkbox" name="cartNo" th:value="${item.cartNo}" class="form-check-input">
                    </div>
                </td>
                <td>
                    <div class="d-flex align-items-center">
                        <img th:src="@{/product_images/{imageName}(imageName=${item.product.prodImage1})}" class="mr-2 img_prod" alt="상품 이미지">
                        <span th:text="${item.product.prodName}">상품명</span>
                    </div>
                </td>
                <td>
                    <input type="number" class="form-control mt-4" th:value="${item.cartQuantity}" min="1">
                </td>
                <td>
                    <span th:text="${item.cartQuantity * item.product.prodPrice} + '원'">상품금액</span>
                </td>
                <td>
                    <span>3,000원</span>
                </td>
                <td>
                    <button class="btn btn-danger btn-delete" th:data-cart-no="${item.cartNo}">삭제</button>
                </td>
            </tr>
            </tbody>
        </table>
    </div>

    <div class="mt-4 d-flex justify-content-between">
        <div>
            <button class="btn btn-danger">선택 상품 삭제</button>
        </div>
        <div>
            <button class="btn btn-success">전체 상품 주문</button>
        </div>
    </div>

    <div class="mt-4 bg-light p-3 rounded">
        <h5>주문 요약</h5>
        <div class="d-flex justify-content-between">
            <span>총 상품금액:</span>
            <span th:text="${#aggregates.sum(cartItems.![cartQuantity * product.prodPrice])} + '원'">0원</span>
        </div>
        <div class="d-flex justify-content-between">
            <span>배송비:</span>
            <span>3,000원</span>
        </div>
        <div class="d-flex justify-content-between font-weight-bold mt-2">
            <span>합계:</span>
            <span th:text="${#aggregates.sum(cartItems.![cartQuantity * product.prodPrice]) + 3000} + '원'">0원</span>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        document.querySelectorAll(".btn-delete").forEach(button => {
            button.addEventListener("click", function() {
                const cartNo = this.getAttribute("data-cart-no");
                if (confirm("해당 상품을 삭제하시겠습니까?")) {
                    location.href = "/cart/remove/" + cartNo;
                }
            });
        });
    });
</script>

</body>
</html>